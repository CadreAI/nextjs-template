#!/bin/sh

echo "Running pre-commit checks..."

# Check Prettier formatting on staged ts files
STAGED_TS_FILES=$(git diff --cached --name-only --diff-filter=ACMR | grep -E '\.(ts|tsx)$' || true)

if [ -n "$STAGED_TS_FILES" ]; then
    echo "Checking Prettier formatting..."
    for FILE in $STAGED_TS_FILES; do
        if [ -f "$FILE" ]; then
            if ! bunx prettier --check "$FILE" >/dev/null 2>&1; then
                echo "Error: $FILE is not formatted"
                echo "Run 'bun run prettier:fix' to fix formatting"
                exit 1
            fi
        fi
    done
fi

# Check ESLint
echo "Checking ESLint..."
if ! bun run lint >/dev/null 2>&1; then
    echo "Error: ESLint found issues"
    echo "Run 'bun run lint' to see details"
    exit 1
fi

echo "All checks passed"
exit 0
